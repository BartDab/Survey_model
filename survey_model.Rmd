---
title: "Model lasu losowego na danych ankietowych - część 2"
author: "Bartosz Dąbrowski"
date: "30 05 2020"
output: html_document
---
# Wczytanie danych

```{r echo=FALSE, message=FALSE, warning=FALSE}
require(tidyverse)
require(stringr)
require(tm)
require(randomForest)
require(Metrics)
require(viridis)
require(gridExtra)
```

Import przygotowanych danych i delikatne zmiany.

```{r echo=FALSE, message=FALSE}
set.seed(42)
data <- read.table("E:/survey_model/dane_ankieta.tsv",sep="\t",header=TRUE,fileEncoding = "UTF-8", check.names=FALSE)
```


```{r echo=FALSE}
data[,27]<-as.factor(data[,27])
```

Na potrzeby modelu, usunąć należy kolumny bez zdolności predykcyjnej - sygnaturę czasową, dobrowolny feedback oraz pytanie o miejsce zamieszkanie w trakcie studiów, które zostało już rozbite na 5 zmiennych zero-jedynkowych.

```{r echo=FALSE}
df0<-data[,-28]
df0<-df0[,-17]
df0<-df0[,-1]
```

Dla większej czytelności zmieniono nazwy kolumn.

```{r echo=FALSE}
colnames(df0)[1:31]<-c('Kobieta','Wiek','Wojewodztwo_pochodzenia', 'Wielkosc_miasta', 'Miasto', 'Wiecej_kierunkow', 'Rok','Prywatna','Zaocznie', 'Typ','Kola','Organizacje','Samorzad','Srednia','Stypendium','Wiodace','Zapychacze','Zapychacze_dobor','Jezyk','Organizacja_uczelni','Plany','Trudnosc','Przydatnosc','Ogolna_ocena','Praca','Akademik','Dom_mieszkanie_rodzinne','Wynajete_mieszkanie','Wynajety_pokoj','Inne','Dyscyplina')
colnames(df0)
df<-df0
```

# Eksploracyjna analiza danych

```{r}
df0$Wielkosc_miasta<-factor(df0$Wielkosc_miasta,level=c("poniżej 5 tysięcy","5 - 20 tysięcy","20 - 100 tysięcy", "100 - 200 tysięcy","200 - 500 tysięcy","powyżej 500 tysięcy"))
df0$Rok<-factor(df0$Rok,level=c('I','II','III','IV','V','Ukończyłem/ukończyłam studia'))
df0$Typ<-factor(df0$Typ,level=c("Artystyczna","Ekonomiczna","Pedagogiczna","Techniczna","Uniwersytet","Inna"))
df0$Dyscyplina<-factor(df0$Dyscyplina,level=c('Nauki humanistyczne','Nauki inzynieryjno-techniczne','Nauki o zdrowiu','Nauki przyrodnicze','Nauki rolnicze','Nauki scisle','Nauki spoleczne','Sztuki piękne','Inne'))
```

```{r}
summary(df0)
str(df0)
```
```{r}
data2<-df0%>%
  dplyr::group_by(Kobieta)%>%
  dplyr::count()
g1<-ggplot(data2, aes(x=data2$Kobieta,y=data2$n,fill=data2$Kobieta))+geom_bar(stat='identity')+ theme(legend.position = "none")+
   geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+
  ylab('')+scale_color_viridis(option = "C")+scale_x_discrete(limits=c(0,1))+ ggtitle('Płeć:')+theme(plot.title = element_text(hjust = 0.5))
g1
```

```{r}
data2<-df0%>%
  dplyr::group_by(Wiek)%>%
  dplyr::count()
g2<-ggplot(data2, aes(x=as.factor(data2$Wiek),y=data2$n,fill=as.factor(data2$Wiek)))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  theme(axis.text.x = element_text(angle = 70, hjust = 1))+ geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Wiek:')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "D")+ylim(0,105)
g2
```

```{r}
data2<-df0%>%
  dplyr::group_by(Wojewodztwo_pochodzenia)%>%
  dplyr::count()
g3<-ggplot(data2, aes(x=data2$Wojewodztwo_pochodzenia,y=data2$n,fill=data2$Wojewodztwo_pochodzenia))+geom_bar(stat='identity')+ theme(legend.position = "none")+
   geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+
  ylab('')+scale_color_viridis(option = "C")+ ggtitle('Województwo pochodzenia:')+theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 70, hjust = 1))+ylim(0,100)
g3
```


```{r}
data2<-df0%>%
  dplyr::group_by(Wielkosc_miasta)%>%
  dplyr::count()
g4<-ggplot(data2, aes(x=data2$Wielkosc_miasta,y=data2$n,fill=data2$Wielkosc_miasta))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Wielkość miasta:')+theme(plot.title = element_text(hjust = 0.5))+ylim(0,155)
g4
```

```{r}
data2<-df0%>%
  dplyr::group_by(Miasto)%>%
  dplyr::count()
g5<-ggplot(data2, aes(x=data2$Miasto,y=data2$n,fill=data2$Miasto))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Miasto:')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "D")+
  theme(axis.text.x = element_text(angle = 70, hjust = 1))+ylim(0,140)
g5
```

```{r}
data2<-df0%>%
  dplyr::group_by(Wiecej_kierunkow)%>%
  dplyr::count()
g6<-ggplot(data2, aes(x=data2$Wiecej_kierunkow,y=data2$n,fill=data2$Wiecej_kierunkow))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Studiowanie więcej niż 1 kierunku')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "D")+scale_x_discrete(limits=c(0,1))
g6
```

```{r}
data2<-df0%>%
  dplyr::group_by(Rok)%>%
  dplyr::count()
g7<-ggplot(data2, aes(x=data2$Rok,y=data2$n,fill=data2$Rok))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Rok studiów')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")+scale_x_discrete(labels=c('I','II','III','IV','V','Ukończyłem/ukończyłam\nstudia'))
g7
```

```{r}
data2<-df0%>%
  dplyr::group_by(Prywatna)%>%
  dplyr::count()
g8<-ggplot(data2, aes(x=data2$Prywatna,y=data2$n,fill=data2$Prywatna))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Uczelnia prywatna')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "D")+scale_x_discrete(limits=c(0,1))
g8
```

```{r}
data2<-df0%>%
  dplyr::group_by(Zaocznie)%>%
  dplyr::count()
g9<-ggplot(data2, aes(x=data2$Zaocznie,y=data2$n,fill=data2$Zaocznie))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Studia zaoczne')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "D")+scale_x_discrete(limits=c(0,1))
g9
```

```{r}
data2<-df0%>%
  dplyr::group_by(Typ)%>%
  dplyr::count()
g10<-ggplot(data2, aes(x=data2$Typ,y=data2$n,fill=data2$Typ))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Typ uczelni')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")
g10
```

```{r}
data2<-df0%>%
  dplyr::group_by(Kola)%>%
  dplyr::count()
g11<-ggplot(data2, aes(x=data2$Kola,y=data2$n,fill=data2$Kola))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Koła naukowe')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")+scale_x_discrete(limits=c(0,1))
g11
```

```{r}
data2<-df0%>%
  dplyr::group_by(Organizacje)%>%
  dplyr::count()
g12<-ggplot(data2, aes(x=data2$Organizacje,y=data2$n,fill=data2$Organizacje))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Organizacje studenckie')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")+scale_x_discrete(limits=c(0,1))
g12
```

```{r}
data2<-df0%>%
  dplyr::group_by(Samorzad)%>%
  dplyr::count()
g13<-ggplot(data2, aes(x=data2$Samorzad,y=data2$n,fill=data2$Samorzad))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Samorząd studencki')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")+scale_x_discrete(limits=c(0,1))
g13
```

```{r}
data2<-df0%>%
  dplyr::group_by(Srednia)%>%
  dplyr::count()
g14<-ggplot(data2, aes(x=data2$Srednia,y=data2$n,fill=data2$Srednia))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Średnia z całych studiów')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")
g14
```

```{r}
data2<-df0%>%
  dplyr::group_by(Stypendium)%>%
  dplyr::count()
g15<-ggplot(data2, aes(x=data2$Stypendium,y=data2$n,fill=data2$Stypendium))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Uzyskanie stypendium naukowego w ciągu studiów')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")+scale_x_discrete(limits=c(0,1))
g15
```

```{r}
data2<-df0%>%
  dplyr::group_by(Wiodace)%>%
  dplyr::count()
g16<-ggplot(data2, aes(x=data2$Wiodace,y=data2$n,fill=data2$Wiodace))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Ocena jakości przedmiotów wiodących')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")
g16
```

```{r}
data2<-df0%>%
  dplyr::group_by(Zapychacze)%>%
  dplyr::count()
g17<-ggplot(data2, aes(x=data2$Zapychacze,y=data2$n,fill=data2$Zapychacze))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Ocena jakości przedmiotów niepowiązanych z kierunkiem')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")
g17
```

```{r}
data2<-df0%>%
  dplyr::group_by(Zapychacze_dobor)%>%
  dplyr::count()
g18<-ggplot(data2, aes(x=data2$Zapychacze_dobor,y=data2$n,fill=data2$Zapychacze_dobor))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Ocena doboru przedmiotów niezwiązanych z kierunkiem')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")
g18
```

```{r}
data2<-df0%>%
  dplyr::group_by(Jezyk)%>%
  dplyr::count()
g19<-ggplot(data2, aes(x=data2$Jezyk,y=data2$n,fill=data2$Jezyk))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Ocena jakości nauczania języków obcego')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")
g19
```

```{r}
data2<-df0%>%
  dplyr::group_by(Organizacja_uczelni)%>%
  dplyr::count()
g20<-ggplot(data2, aes(x=data2$Organizacja_uczelni,y=data2$n,fill=data2$Organizacja_uczelni))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Ocena organizacji na uczelni')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")
g20
```

```{r}
data2<-df0%>%
  dplyr::group_by(Plany)%>%
  dplyr::count()
g21<-ggplot(data2, aes(x=data2$Plany,y=data2$n,fill=data2$Plany))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Ocena planów zajęć')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")
g21
```

```{r}
data2<-df0%>%
  dplyr::group_by(Trudnosc)%>%
  dplyr::count()
g22<-ggplot(data2, aes(x=data2$Trudnosc,y=data2$n,fill=data2$Trudnosc))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Ocena trudności studiów')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")
g22
```

```{r}
data2<-df0%>%
  dplyr::group_by(Przydatnosc)%>%
  dplyr::count()
g23<-ggplot(data2, aes(x=data2$Przydatnosc,y=data2$n,fill=data2$Przydatnosc))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Ocena przydatności studiów')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")
g23
```

```{r}
data2<-df0%>%
  dplyr::group_by(Ogolna_ocena)%>%
  dplyr::count()
g24<-ggplot(data2, aes(x=data2$Ogolna_ocena,y=data2$n,fill=data2$Ogolna_ocena))+geom_bar(stat='identity')+ theme(legend.position = "none")+
  geom_text(aes(label = n), position =position_dodge(width=0.9), vjust=-0.25)+
  xlab('')+ylab('')+ ggtitle('Ogólna ocena studiów')+theme(plot.title = element_text(hjust = 0.5))+scale_color_viridis(option = "B")
g24
```






```{r}
#figure <- grid.arrange(g1, g2, g3, g4, ncol=2,nrow=2)
#figure
```

# MODELE

```{r echo=FALSE}
model1<-randomForest(Praca~.,data=df,ntree=1000,mtry=5,importance=TRUE)
print(model1)
importance(model1,class=TRUE)
```

Wykres modelu przedstawia kształtowanie się błędu poza próbką w raz ze wzrostem liczby drzew. Po gwałtownym zmniejszaniu do około 200, następuje stablizacja. Zielona linia oznacza błąd w klasyfikacji pracujących, czerwona - niepracujących, a czarna - uśredniony dla obu grup.

```{r echo=FALSE}
plot(model1)
auc_model<-auc(df$Praca,model1$predicted)
err<-(model1$confusion[2]+model1$confusion[3])/nrow(df)
acc<-(model1$confusion[1]+model1$confusion[4])/nrow(df)
sens<-model1$confusion[1]/(model1$confusion[1]+model1$confusion[3])
spec<-model1$confusion[4]/(model1$confusion[4]+model1$confusion[2])
gmean<-sqrt(sens*spec)
recall<-model1$confusion[1]/(model1$confusion[1]+model1$confusion[2])
prec<-model1$confusion[1]/(model1$confusion[1]+model1$confusion[3])
cat("AUC: ", auc_model,"\nOOB Error: ", err,"\nAccuracy: ", acc,"\nSensitivity: ", sens,"\nSpecifity: ", spec,"\nG-Mean: ", gmean,"\nRecall: ", recall,"\nPrecision: ", prec)
```

Pierwszy zbudowany model cechuje stosunkowa dobra dokładność - ponad 70%. Ma dość wysoką czułość kosztem niskiej swoistości - wiąże się to z dużo lepszym wykrywaniem bezrobotnych, podczas gdy skuteczność w przypadku pracujących wynosi niewiele ponad 50%. Najprawdopodobniej wpływ na to ma dysproporcja w próbkach. W następnym modelu zostaną one wyrównane.

## Model z wyrównanymi próbkami

```{r echo=FALSE}
model2<-randomForest(Praca~.,data=df,ntree=1000,mtry=5,importance=TRUE,sampsize=c(155,155))
print(model2)
importance(model2,class=TRUE)
```

```{r echo=FALSE}
plot(model2)
auc_model<-auc(df$Praca,model2$predicted)
err<-(model2$confusion[2]+model2$confusion[3])/nrow(df)
acc<-(model2$confusion[1]+model2$confusion[4])/nrow(df)
sens<-model2$confusion[1]/(model2$confusion[1]+model2$confusion[3])
spec<-model2$confusion[4]/(model2$confusion[4]+model2$confusion[2])
gmean<-sqrt(sens*spec)
recall<-model2$confusion[1]/(model2$confusion[1]+model2$confusion[2])
prec<-model2$confusion[1]/(model2$confusion[1]+model2$confusion[3])
cat("AUC: ", auc_model,"\nOOB Error: ", err,"\nAccuracy: ", acc,"\nSensitivity: ", sens,"\nSpecifity: ", spec,"\nG-Mean: ", gmean,"\nRecall: ", recall,"\nPrecision: ", prec)
```

Ogólna skuteczność uległa pogorszeniu. W zamian za to, wyrównaniu uległy czułość i swoistość, i model radzi sobie z klasyfikacją obu grup w podobnym stopniu. Pomimo nieco gorszych wyników, ma on większą wartość.

## PODZIAŁ NA DANE TESTOWE I TRENINGOWE

Po "testowych" modelach na całości danych, przyjęto wstępnie podział 70% dla danych uczących i 30% dla testowych.

```{r echo=FALSE}
n <- nrow(df)
n_train <- round(0.7 * n) 
train_indices <- sample(1:n, n_train)
df_train <- df[train_indices, ]  
df_test <- df[-train_indices, ]  
```

```{r echo=FALSE}
table(df_train$Praca)
model_train<-randomForest(Praca~.,data=df_train,ntree=1000,mtry=5,importance=TRUE,sampsize=c(104,104))
print(model_train)
importance(model_train,class=TRUE)
```

```{r echo=FALSE}
plot(model_train)
```

```{r echo=FALSE}
test_rf<-predict(model_train,newdata=df_test)
mtx<-as.matrix(table(test_rf,df_test$Praca))
auc_model<-auc(df_test$Praca,test_rf)
err<-(mtx[2]+mtx[3])/nrow(df_test)
acc<-(mtx[1]+mtx[4])/nrow(df_test)
sens<-mtx[1]/(mtx[1]+mtx[3])
spec<-mtx[4]/(mtx[4]+mtx[2])
gmean<-sqrt(sens*spec)
recall<-mtx[1]/(mtx[1]+mtx[2])
prec<-mtx[1]/(mtx[1]+mtx[3])
cat("AUC: ", auc_model,"\nOOB Error: ", err,"\nAccuracy: ", acc,"\nSensitivity: ", sens,"\nSpecifity: ", spec,"\nG-Mean: ", gmean,"\nRecall: ", recall,"\nPrecision: ", prec)
```

## Próba wykluczenia z modelu obserwacji o wątpliwej wiarygodności

Niektórzy z respondentów w pytaniu o feedback zgłaszali problemy z ankietą - najczęściej były to wątpliwości co do przypisania swojej uczelni bądź kierunku, niekiedy niepewność co do właściwego interpretowania swojej pracy - czy jest ona związana ze studiami. Do następnego modelu wykorzystane zostaną dane oczyszczone z takich obserwacji.

```{r echo=FALSE, message=FALSE,warning=FALSE}
df1<-df0[,-17]
df1<-df1[,-1]
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
#df0[!(is.na(df0[,26])),25:26] #analiza feedbacku - respondenci zgłaszający problemy z zaznaczeniem odpowiadających ich sytuacji opcji zostaną usunięci z danych
df2<-df1[-c(60, 103, 240, 244, 258,276, 321,345,347,348,366,87, 264),-26]
```

```{r echo=FALSE}
table(df2$Praca)
model3<-randomForest(Praca~.,data=df2,ntree=1000,mtry=5,importance=TRUE,sampsize=c(150,150))
print(model3)
importance(model3,class=TRUE)
```

```{r echo=FALSE}
plot(model3) #zielony - pracuję, czarny - średni, czerwony - jeszcze nie
varImpPlot(model3)
```

Po gwałtownym zmniejszaniu do około 350, następuje stablizacja, najniższe wartości osiągając w granicach 600 i ustrzymując się od tej pory na stosunkowo stabilnym poziomie. Zielona linia oznacza błąd w klasyfikacji pracujących, czerwona - niepracujących, a czarna - uśredniony dla obu grup.

```{r echo=FALSE}
auc_model<-auc(df2$Praca,model3$predicted)
err<-(model3$confusion[2]+model3$confusion[3])/400
acc<-(model3$confusion[1]+model3$confusion[4])/400
sens<-model3$confusion[1]/(model3$confusion[1]+model3$confusion[3])
spec<-model3$confusion[4]/(model3$confusion[4]+model3$confusion[2])
gmean<-sqrt(sens*spec)
recall<-model3$confusion[1]/(model3$confusion[1]+model3$confusion[2])
prec<-model3$confusion[1]/(model3$confusion[1]+model3$confusion[3])
cat("AUC: ", auc_model,"\nOOB Error: ", err,"\nAccuracy: ", acc,"\nSensitivity: ", sens,"\nSpecifity: ", spec,"\nG-Mean: ", gmean,"\nRecall: ", recall,"\nPrecision: ", prec)
```

Z 13 usuniętych przypadków, 8 było błędni klasyfikowanych - 5 pracujących było uznawanych za bezrobotnych, 3 bezrobotnych - za pracujących. Przyniosło to delikatną poprawę; jest to najlepszy z dotychczasowych modeli na pełnych danych.

### Model oczyszczony z wątpliwych obserwacji z podziałem na dane treningowe i testowe

Podobnie jak wcześniej, przyjmuję podział 0,7:0,3.

```{r echo=FALSE}
n <- nrow(df2)
n_train <- round(0.7 * n) 
train_indices <- sample(1:n, n_train)
df_train2 <- df2[train_indices, ]  
df_test2 <- df2[-train_indices, ]  
```

```{r echo=FALSE}
table(df_train2$Praca)
model_train2<-randomForest(Praca~.,data=df_train2,ntree=1000,mtry=5,importance=TRUE,sampsize=c(104,104))
print(model_train2)
importance(model_train2,class=TRUE)
```

```{r echo=FALSE}
cat("AUC na danych treningowych: ", auc(df_train2$Praca,model_train2$predicted))
```

```{r echo=FALSE}
test_rf<-predict(model_train2,newdata=df_test2)
mtx<-as.matrix(table(test_rf,df_test2$Praca))
auc_model<-auc(df_test2$Praca,test_rf)
err<-(mtx[2]+mtx[3])/nrow(df_test2)
acc<-(mtx[1]+mtx[4])/nrow(df_test2)
sens<-mtx[1]/(mtx[1]+mtx[3])
spec<-mtx[4]/(mtx[4]+mtx[2])
gmean<-sqrt(sens*spec)
recall<-mtx[1]/(mtx[1]+mtx[2])
prec<-mtx[1]/(mtx[1]+mtx[3])
cat("AUC: ", auc_model,"\nOOB Error: ", err,"\nAccuracy: ", acc,"\nSensitivity: ", sens,"\nSpecifity: ", spec,"\nG-Mean: ", gmean,"\nRecall: ", recall,"\nPrecision: ", prec)
```
